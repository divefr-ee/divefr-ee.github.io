<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/apple-touch-icon-512x512.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>divefree: Ulua Beach</title>
    <script src="/plotly-basic.min.js"></script>
    <style>
        html {
          height: 100%;
          margin: 0;
          overflow: hidden;
        }
        body {
          height: 100%;
          font-family: Arial, sans-serif;
          color: #555;
          overflow-y: auto;
          overflow-x: hidden;
        }
        #divePlot {
          width: 100%;
        }
        #mapPane {
          width: 100%;
        }
    </style>
  </head>
  <body>
    
    <div id="divePlot"></div>
    
    <br/>

    <div id="mapPane">
      <center>
        <iframe
            id="mapIframe"
            width="70%"
            height="200px"
            loading="lazy"
            frameborder="0"
            scrolling="no"
            src="https://www.openstreetmap.org/export/embed.html?bbox=-0.1%2C-0.1%2C0.1%2C0.1&marker=0,0">
        </iframe>
      </center>
    </div>
    
    <script>
      const title = '';
      const xlabel = 'time (s)';
      const ylabel1 = 'depth (m)';
      const ylabel2 = 'rate (m/s)';
      const color1 = 'royalblue';
      const color2 = 'darkgrey';
      const dataset = {
        date: "2024-11-23",
        time: "10:57:38",
        lat: 20.68886,
        lon: -156.4443,
        locname: "Ulua Beach",
        t: [0,0.25,0.5,0.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5,5.25,5.5,5.75,6,6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25,8.5,8.75,9,9.25,9.5,9.75,10,10.25,10.5,10.75,11,11.25,11.5,11.75,12,12.25,12.5,12.75,13,13.25,13.5,13.75,14,14.25,14.5,14.75,15,15.25,15.5,15.75,16,16.25,16.5,16.75,17,17.25,17.5,17.75,18,18.25,18.5,18.75,19,19.25,19.5,19.75,20,20.25,20.5,20.75,21,21.25,21.5,21.75,22,22.25,22.5,22.75,23,23.25,23.5,23.75,24,24.25,24.5,24.75,25,25.25,25.5,25.75,26,26.25,26.5,26.75,27,27.25,27.5,27.75,28,28.25,28.5,28.75,29,29.25,29.5,29.75,30,30.25,30.5,30.75,31,31.25,31.5,31.75,32,32.25,32.5,32.75,33,33.25,33.5,33.75,34,34.25,34.5,34.75,35,35.25,35.5,35.75,36,36.25,36.5,36.75,37,37.25,37.5,37.75,38,38.25,38.5,38.75,39,39.25,39.5,39.75,40,40.25,40.5,40.75,41,41.25,41.5,41.75,42,42.25,42.5,42.75,43,43.25,43.5,43.75,44,44.25,44.5,44.75,45],
        depth: [-0.05,-0,-0.09,-0.72,-1.08,-1.07,-0.56,-0.88,-1.04,-1.27,-1.48,-1.8,-2.15,-2.39,-2.47,-2.55,-2.68,-2.79,-2.87,-2.79,-2.7,-2.8,-3,-2.92,-2.88,-2.91,-3.15,-3.33,-3.47,-3.47,-3.44,-3.4,-3.38,-3.37,-3.35,-3.34,-3.33,-3.31,-3.33,-3.35,-3.1,-2.7,-2.75,-2.99,-3.13,-3.24,-3.28,-3.3,-3.38,-3.41,-3.33,-3.35,-3.44,-3.55,-3.56,-3.55,-3.63,-3.6,-3.53,-3.5,-3.47,-3.45,-3.47,-3.46,-3.47,-3.47,-3.49,-3.49,-3.48,-3.52,-3.55,-3.53,-3.5,-3.46,-3.43,-3.48,-3.47,-3.42,-3.35,-3.27,-3.14,-3.01,-2.89,-2.8,-2.73,-2.73,-2.7,-2.67,-2.48,-2.2,-2.13,-2.21,-2.66,-2.81,-2.71,-2.42,-2.1,-2.29,-2.5,-2.77,-2.91,-2.8,-2.8,-2.77,-2.85,-2.74,-2.23,-2.35,-2.42,-2.48,-2.48,-2.42,-2.45,-2.58,-2.77,-2.77,-2.75,-2.81,-2.93,-2.85,-2.85,-2.95,-3.14,-2.93,-2.89,-2.96,-3.12,-3.1,-3.07,-3.1,-3.23,-3.19,-3.06,-3.12,-3.21,-3.02,-2.81,-2.71,-2.67,-2.58,-2.54,-2.52,-2.5,-2.48,-2.57,-2.7,-2.48,-2.25,-2.39,-2.47,-2.41,-2.32,-2.15,-1.91,-2.1,-1.97,-1.78,-1.58,-1.33,-1.07,-0.62,-0.37,-0.3,-0.14,-0.01,-0.07,-0.24,0.05,-0.16,-0.34,-0.21,-0.08,-0.35,-0.24,-0.04,-0.08,-0.39,-0.28,-0.18,-0.1,-0.39],
        temperature: ["26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20"],
        vertrates: [0.2,0.032,-0.7336,-0.94552,-0.649864,0.1570952,-0.27403336,-0.383823352,-0.5446763464,-0.63327344248,-0.827291409736,-0.9991039868152,-0.98737279077064,-0.787160953539448,-0.647012667477613,-0.60890886723433,-0.558236207064031,-0.486765344944821,-0.244735741461375,-0.0633150190229626,-0.164320513316073,-0.355024359321252,-0.152517051524876,-0.0587619360674132,-0.0771333552471895,-0.341993348673032,-0.455395344071123,-0.486776740849786,-0.34074371859485,-0.202520603016395,-0.0937644221114763,-0.0416350954780334,-0.0171445668346236,0.0119988032157635,0.0203991622510347,0.026279413575724,0.0423955895030068,0.00567691265210477,-0.0200261611435267,0.285981687199531,0.680187181039672,0.41613102672777,0.00329171870943906,-0.165695796903392,-0.247987057832375,-0.221590940482663,-0.179113658337863,-0.221379560836504,-0.190965692585553,-0.0376759848098872,-0.0503731893669211,-0.143261232556845,-0.232282862789791,-0.174598003952854,-0.110218602766998,-0.173153021936898,-0.0852071153558291,0.0243550192509195,0.0530485134756439,0.0731339594329505,0.0751937716030654,0.0286356401221457,0.0320449480855023,0.0104314636598513,0.00730202456189593,-0.0188885828066729,-0.013222007964671,0.00274459442473057,-0.0460787839026886,-0.0682551487318818,-0.0237786041123178,0.0193549771213779,0.0615484839849645,0.0790839387894749,-0.00464124284736733,0.00875113000684261,0.0661257910047901,0.130288053703353,0.187201637592347,0.287041146314643,0.35692880242025,0.393850161694175,0.383695113185923,0.352586579230146,0.246810605461102,0.208767423822771,0.18213719667594,0.355496037673158,0.58484722637121,0.493393058459848,0.249375140921893,-0.365437401354675,-0.435806180948272,-0.185064326663791,0.218454971335347,0.536918479934742,0.14784293595432,-0.148509944831976,-0.427956961382383,-0.467569872967668,-0.195298911077368,-0.136709237754157,-0.0596964664279103,-0.137787526499537,0.0355487314503237,0.636884112015227,0.301818878410659,0.127273214887461,0.0170912504212228,0.0119638752948559,0.0803747127063992,0.0202622988944792,-0.141816390773864,-0.327271473541705,-0.229090031479194,-0.136363022035435,-0.167454115424805,-0.261217880797364,-0.0868525165581544,-0.0607967615907081,-0.162557733113496,-0.341790413179447,0.0127467107743871,0.056922697542071,-0.0441541117205501,-0.222907878204385,-0.13203551474307,-0.0564248603201484,-0.0754974022241042,-0.208848181556873,-0.0981937270898109,0.0872643910371322,-0.0109149262740075,-0.115640448391805,0.147051686125736,0.354936180288015,0.368455326201611,0.305918728341128,0.322143109838789,0.273500176887152,0.215450123821007,0.174815086674705,0.146370560672293,-0.00554060752939504,-0.159878425270576,0.152085102310597,0.382459571617418,0.0997217001321922,-0.0261948099074655,0.0536636330647742,0.145564543145342,0.30589518020174,0.502126626141217,0.123488638298852,0.242442046809197,0.397709432766438,0.518396602936506,0.662877622055554,0.776014335438888,1.08321003480722,1.05824702436506,0.824772917055538,0.769341041938877,0.694538729357214,0.41417711055005,0.0859239773850347,0.408146784169524,0.033702748918667,-0.192408075756933,0.0213143469701468,0.170920042879103,-0.204355969984628,-0.0110491789892396,0.232265574707532,0.114585902295273,-0.291789868393309,-0.0722529078753165,0.0694229644872785,0.144596075141095,-0.246782747401234,-0.520747923180863]
      };
      function updatePlot() {

        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);  // Get full minutes
          const sec = seconds % 60;  // Get the fractional part of the seconds

          // Check if the fractional part is zero
          if (sec % 1 === 0) {
            return `${minutes.toString().padStart(2, '0')}:${Math.floor(sec).toString().padStart(2, '0')}`; // No decimal part if it's zero
          } else {
            return `${minutes.toString().padStart(2, '0')}:${sec.toFixed(2).padStart(5, '0')}`; // With fractional seconds
          }
        }

        // Calculate the time difference (dt) between the first two timestamps
        var dt = dataset.t[1] - dataset.t[0];
        
        dataset.t = dataset.t.map(formatTime);

        // Calculate the number of samples needed to cover 5 seconds
        var tickInterval = Math.round(5 / dt);
        var tickVals = dataset.t.filter((time, index) => index % tickInterval === 0);
        var tickText = tickVals;

        var colors = dataset.vertrates.map(rate => {
          if (rate < 0) {
            return 'darkgrey';
          } else return 'lightgrey';
        });

        Plotly.react('divePlot', [
          {
            x: dataset.t,
            y: dataset.depth,
            mode: 'lines',
            type: 'scatter',
            name: ylabel1,
            yaxis: 'y',
            line: { color: color1 },
            zorder: 2
          },
          {
            x: dataset.t,
            y: dataset.vertrates,
            mode: 'lines',
            type: 'bar',
            name: ylabel2,
            yaxis: 'y2',
            marker: { color: colors },
            zorder: 1
          }
        ], {
          title: dataset.date + " // " + dataset.time + " // " + dataset.locname,
          showlegend: false,
          xaxis: { 
            title: xlabel,
            tickvals: tickVals,
            ticktext: tickText
          },
          yaxis: { title: ylabel1, side: 'left', titlefont: { color: color1 }, tickfont: { color: color1 } },
          yaxis2: {
            title: ylabel2,
            overlaying: 'y',
            side: 'right',
            titlefont: { color: color2 },
            tickfont: { color: color2 },
            showgrid: false // Optional: Hide the grid for the right Y-axis
          }
        });

        // Update the iframe URL with new coordinates and bbox
        const lat = dataset.lat;
        const lon = dataset.lon;
        if (lat && lon ){
          const newBBox = `${lon - 0.03}%2C${lat - 0.03}%2C${lon + 0.03}%2C${lat + 0.03}`;
          const newMarker = `${lat},${lon}`;
          const newIframeSrc = `https://www.openstreetmap.org/export/embed.html?bbox=${newBBox}&marker=${newMarker}`;
          document.getElementById('mapIframe').src = newIframeSrc;
        }else{
          document.getElementById('mapIframe').src = ``;
        }
      }

      // Initial plot with the first dataset
      updatePlot();

      window.addEventListener('resize', function() {
        Plotly.Plots.resize(document.getElementById('divePlot'));
      });

    </script>
  </body>
</html>
