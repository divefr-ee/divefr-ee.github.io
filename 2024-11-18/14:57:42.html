<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/apple-touch-icon-512x512.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>divefree: Kahalu'u</title>
    <script src="/plotly-basic.min.js"></script>
    <style>
        html {
          height: 100%;
          margin: 0;
          overflow: hidden;
        }
        body {
          height: 100%;
          font-family: Arial, sans-serif;
          color: #555;
          overflow-y: auto;
          overflow-x: hidden;
        }
        #divePlot {
          width: 100%;
        }
        #mapPane {
          width: 100%;
        }
    </style>
  </head>
  <body>
    
    <div id="divePlot"></div>
    
    <br/>

    <div id="mapPane">
      <center>
        <iframe
            id="mapIframe"
            width="70%"
            height="200px"
            loading="lazy"
            frameborder="0"
            scrolling="no"
            src="https://www.openstreetmap.org/export/embed.html?bbox=-0.1%2C-0.1%2C0.1%2C0.1&marker=0,0">
        </iframe>
      </center>
    </div>
    
    <script>
      const title = '';
      const xlabel = 'time (s)';
      const ylabel1 = 'depth (m)';
      const ylabel2 = 'rate (m/s)';
      const color1 = 'royalblue';
      const color2 = 'darkgrey';
      const dataset = {
        date: "2024-11-18",
        time: "14:57:42",
        lat: 19.57943,
        lon: -155.967011,
        locname: "Kahalu'u",
        t: [0,0.25,0.5,0.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5,5.25,5.5,5.75,6,6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25,8.5,8.75,9,9.25,9.5,9.75,10,10.25,10.5,10.75,11,11.25,11.5,11.75,12,12.25,12.5,12.75,13,13.25,13.5,13.75,14,14.25,14.5,14.75,15,15.25,15.5,15.75,16,16.25,16.5,16.75,17,17.25,17.5,17.75,18,18.25,18.5,18.75,19,19.25,19.5,19.75,20,20.25,20.5,20.75,21,21.25,21.5,21.75,22,22.25,22.5,22.75,23,23.25,23.5,23.75,24,24.25,24.5,24.75,25,25.25,25.5,25.75,26,26.25,26.5,26.75,27,27.25,27.5,27.75,28,28.25,28.5,28.75,29,29.25,29.5,29.75,30,30.25,30.5,30.75,31,31.25,31.5,31.75,32,32.25,32.5,32.75,33,33.25,33.5,33.75,34,34.25,34.5,34.75,35,35.25,35.5,35.75,36,36.25,36.5,36.75,37,37.25,37.5,37.75,38,38.25,38.5,38.75,39,39.25,39.5,39.75,40,40.25,40.5,40.75,41,41.25,41.5,41.75,42,42.25,42.5,42.75,43,43.25,43.5,43.75,44,44.25,44.5,44.75,45,45.25,45.5,45.75,46,46.25,46.5,46.75,47,47.25,47.5,47.75,48,48.25,48.5,48.75,49,49.25,49.5,49.75,50,50.25,50.5,50.75,51,51.25,51.5,51.75,52,52.25,52.5,52.75,53,53.25,53.5,53.75,54,54.25,54.5,54.75,55,55.25,55.5,55.75,56,56.25,56.5,56.75,57,57.25,57.5,57.75,58,58.25,58.5,58.75,59,59.25,59.5,59.75,60,60.25,60.5,60.75,61,61.25,61.5,61.75,62,62.25,62.5,62.75,63,63.25,63.5,63.75,64,64.25,64.5,64.75,65],
        depth: [-0.37,-0.87,-1.34,-1.24,-1.27,-1.11,-1.22,-1.46,-1.7,-2.16,-2.32,-1.8,-1.83,-2.41,-2.02,-1.87,-2.16,-2.35,-2.68,-2.74,-2.5,-2.53,-3.05,-3.21,-3.17,-3.16,-3.16,-3.17,-3.13,-3.11,-3.09,-3.09,-3.1,-3.11,-3.09,-3.07,-3.03,-2.99,-2.94,-2.91,-2.88,-2.83,-2.77,-2.81,-2.81,-2.81,-2.78,-2.77,-2.75,-2.72,-2.69,-2.68,-2.67,-2.67,-2.69,-2.72,-2.74,-2.78,-2.78,-2.8,-2.81,-2.8,-2.79,-2.78,-2.75,-2.74,-2.72,-2.7,-2.69,-2.69,-2.68,-2.69,-2.7,-2.73,-2.75,-2.77,-2.8,-2.81,-2.84,-2.83,-2.87,-2.89,-2.85,-2.86,-2.85,-2.85,-2.84,-2.84,-2.83,-2.83,-2.8,-2.81,-2.84,-2.88,-2.91,-2.95,-3.01,-3.06,-3.1,-3.12,-3.13,-3.11,-3.09,-3.03,-2.96,-2.9,-2.83,-2.79,-2.76,-2.77,-2.78,-2.79,-2.8,-2.81,-2.81,-2.81,-2.81,-2.77,-2.72,-2.68,-2.66,-2.7,-2.55,-2.51,-2.41,-2.3,-1.95,-1.94,-2.23,-2.33,-2.46,-2.48,-2.51,-2.57,-2.72,-2.9,-2.89,-2.9,-2.9,-2.89,-2.66,-2.69,-2.71,-2.75,-2.72,-2.65,-2.59,-2.59,-2.54,-2.49,-2.48,-2.35,-2.28,-2.31,-2.5,-2.85,-3.05,-2.8,-2.56,-2.58,-2.54,-2.82,-2.64,-2.69,-2.68,-2.76,-2.75,-2.76,-2.58,-2.59,-2.69,-2.78,-2.83,-2.91,-2.98,-3.02,-3.17,-3.42,-3.26,-3.1,-3.26,-3.29,-3.14,-3.49,-3.31,-3.27,-3.24,-3.23,-3.38,-3.22,-3.2,-3.02,-3.17,-3.11,-3.13,-2.97,-3.07,-2.95,-2.95,-2.77,-2.96,-3.07,-3.08,-3.47,-2.98,-3.15,-3.22,-3.18,-3.43,-3.7,-3.88,-3.91,-3.95,-3.96,-3.61,-3.76,-3.67,-3.92,-3.75,-3.87,-4.06,-3.92,-3.89,-3.52,-3.82,-3.67,-3.53,-3.5,-3.26,-3.08,-2.66,-2.8,-2.79,-2.43,-2.13,-1.89,-2.08,-1.78,-1.43,-1.01,-0.69,-0.42,-0.2,-0.13,-0.17,-0.11,0.04,-0.33,-0.31,-0.32,-0.17,-0.11,-0.13,-0.06,-0.37,-0.26,-0.08,-0.01,-0.31,-0.22,0.1],
        temperature: ["27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.20","27.30","27.30","27.20","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.30","27.20","27.30","27.30","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.20","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10","27.10"],
        vertrates: [-2,-1.964,-1.2548,-0.91436,-0.448052,-0.4456364,-0.59994548,-0.707961836,-1.0475732852,-0.92530129964,-0.0237109097479998,-0.0525976368235999,-0.73281834577652,-0.0449728420435638,0.148519010569505,-0.244036692601346,-0.398825684820942,-0.67517797937466,-0.544624585562262,-0.093237209893583,-0.101266046925508,-0.694886232847855,-0.678420362993499,-0.426894254095449,-0.286825977866815,-0.20077818450677,-0.152544729154739,-0.0587813104083172,-0.017146917285822,0.0119971578999246,0.00839801052994724,-0.00612139262903721,-0.0162849748403258,0.012600517611772,0.0328203623282404,0.0709742536297683,0.0976819775408373,0.128377384278586,0.12586416899501,0.124104918296507,0.146873442807555,0.174811409965289,0.0743679869757019,0.0520575908829914,0.036440313618094,0.0615082195326655,0.0550557536728661,0.0625390275710063,0.0797773192997047,0.0918441235097931,0.0762908864568549,0.0654036205197987,0.0457825343638591,0.00804777405470134,-0.0303665581617088,-0.0452565907131967,-0.0796796134992377,-0.0557757294494664,-0.063043010614626,-0.0561301074302385,-0.0272910752011666,-0.0071037526408169,0.00702737315142791,0.0409191612059998,0.0406434128441996,0.0524503889909403,0.0607152722936577,0.0545006906055607,0.0381504834238925,0.0387053383967245,0.0150937368777074,-0.00143438418560511,-0.0370040689299233,-0.0499028482509464,-0.0589319937756625,-0.0772523956429635,-0.0660766769500747,-0.0822536738650521,-0.0455775717055367,-0.0799043001938757,-0.079933010135713,-0.00795310709499907,-0.0175671749664991,-0.000297022476549622,-0.000207915733584735,0.011854458986491,0.00829812129054367,0.0178086849033803,0.0124660794323662,0.0447262556026566,0.0193083789218594,-0.0224841347546982,-0.0637388943282888,-0.0806172260298024,-0.104432058220862,-0.145102440754603,-0.161571708528222,-0.161100195969756,-0.136770137178829,-0.10773909602518,-0.051417367217626,-0.0119921570523382,0.0636054900633634,0.128523843044354,0.161966690131048,0.197376683091733,0.186163678164213,0.16631457471495,0.104420202300465,0.0610941416103249,0.0307658991272277,0.00953612938905962,-0.00532470942765854,-0.00372729659936098,-0.00260910761955269,-0.00182637533368688,0.0467215372664192,0.0927050760864938,0.112893553260545,0.103025487282382,0.0241178410976671,0.196882488768367,0.185817742137857,0.2500724194965,0.30705069364755,0.634935485553285,0.456454839887299,-0.0284816120788904,-0.139937128455223,-0.253955989918656,-0.201769192943059,-0.177238435060141,-0.1960669045421,-0.317246833179469,-0.438072783225628,-0.29465094825794,-0.218255663780558,-0.15277896464639,-0.0949452752524736,0.209538307323268,0.110676815126288,0.0534737705884017,-0.0105683605881189,0.0286021475883171,0.104021503311822,0.144815052318275,0.101370536622793,0.130959375635955,0.151671562945168,0.118170094061618,0.238719065843132,0.251103346090192,0.139772342263135,-0.130159360415805,-0.511111552291064,-0.597778086603744,-0.118444660622621,0.205088737564165,0.119562116294915,0.131693481406441,-0.243814563015492,0.045329805889156,-0.0282691358775906,-0.00778839511431366,-0.101451876580019,-0.0590163136060136,-0.0533114195242093,0.178682006333053,0.113077404433137,-0.0408458168968039,-0.136592071827763,-0.155614450279434,-0.204930115195604,-0.227451080636922,-0.207215756445846,-0.325051029512092,-0.527535720658464,-0.177275004460925,0.0679074968773523,-0.144464752185853,-0.137125326530097,0.0840122714289317,-0.361191409999748,-0.0368339869998233,0.0222162091001237,0.0515513463700864,0.0480859424590607,-0.146339840278657,0.0895621118049395,0.0866934782634577,0.276685434784421,0.0136798043490945,0.0815758630443662,0.0331031041310563,0.21517217289174,0.0306205210242176,0.165434364716952,0.115804055301866,0.297062838711307,-0.0200560129020853,-0.14603920903146,-0.114227446322022,-0.547959212425416,0.204428551302209,-0.0609000140884534,-0.126630009861918,-0.0406410069033423,-0.32844870483234,-0.553914093382638,-0.603739865367846,-0.458617905757493,-0.369032534030245,-0.270322773821171,0.23077405832518,-0.0184581591723737,0.0950792885793383,-0.233444497994463,0.0405888514038757,-0.115587804017287,-0.3089114628121,-0.0482380239684707,0.00223338322207031,0.445563368255449,-0.0481056422211858,0.14632605044517,0.270428235311619,0.225299764718134,0.445709835302694,0.527996884711885,0.87359781929832,0.443518473508824,0.322462931456177,0.657724052019323,0.820406836413527,0.862284785489468,0.375599349842628,0.62291954488984,0.856043681422888,1.10323057699602,1.15626140389721,1.13338298272805,1.05736808790964,0.824157661536745,0.528910363075721,0.442237254153005,0.489566077907103,-0.101303745465028,-0.0469126218255194,-0.0448388352778636,0.148612815305495,0.176028970713847,0.0992202794996928,0.153454195649785,-0.264582063045151,-0.0532074441316054,0.178754789107876,0.209128352375513,-0.213610153337141,-0.0415271073359984,0.354931024864801,0.632451717405361]
      };
      function updatePlot() {

        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);  // Get full minutes
          const sec = seconds % 60;  // Get the fractional part of the seconds

          // Check if the fractional part is zero
          if (sec % 1 === 0) {
            return `${minutes.toString().padStart(2, '0')}:${Math.floor(sec).toString().padStart(2, '0')}`; // No decimal part if it's zero
          } else {
            return `${minutes.toString().padStart(2, '0')}:${sec.toFixed(2).padStart(5, '0')}`; // With fractional seconds
          }
        }

        // Calculate the time difference (dt) between the first two timestamps
        var dt = dataset.t[1] - dataset.t[0];
        
        dataset.t = dataset.t.map(formatTime);

        // Calculate the number of samples needed to cover 5 seconds
        var tickInterval = Math.round(5 / dt);
        var tickVals = dataset.t.filter((time, index) => index % tickInterval === 0);
        var tickText = tickVals;

        var colors = dataset.vertrates.map(rate => {
          if (rate < 0) {
            return 'darkgrey';
          } else return 'lightgrey';
        });

        Plotly.react('divePlot', [
          {
            x: dataset.t,
            y: dataset.depth,
            mode: 'lines',
            type: 'scatter',
            name: ylabel1,
            yaxis: 'y',
            line: { color: color1 },
            zorder: 2
          },
          {
            x: dataset.t,
            y: dataset.vertrates,
            mode: 'lines',
            type: 'bar',
            name: ylabel2,
            yaxis: 'y2',
            marker: { color: colors },
            zorder: 1
          }
        ], {
          title: dataset.date + " // " + dataset.time + " // " + dataset.locname,
          showlegend: false,
          xaxis: { 
            title: xlabel,
            tickvals: tickVals,
            ticktext: tickText
          },
          yaxis: { title: ylabel1, side: 'left', titlefont: { color: color1 }, tickfont: { color: color1 } },
          yaxis2: {
            title: ylabel2,
            overlaying: 'y',
            side: 'right',
            titlefont: { color: color2 },
            tickfont: { color: color2 },
            showgrid: false // Optional: Hide the grid for the right Y-axis
          }
        });

        // Update the iframe URL with new coordinates and bbox
        const lat = dataset.lat;
        const lon = dataset.lon;
        if (lat && lon ){
          const newBBox = `${lon - 0.03}%2C${lat - 0.03}%2C${lon + 0.03}%2C${lat + 0.03}`;
          const newMarker = `${lat},${lon}`;
          const newIframeSrc = `https://www.openstreetmap.org/export/embed.html?bbox=${newBBox}&marker=${newMarker}`;
          document.getElementById('mapIframe').src = newIframeSrc;
        }else{
          document.getElementById('mapIframe').src = ``;
        }
      }

      // Initial plot with the first dataset
      updatePlot();

      window.addEventListener('resize', function() {
        Plotly.Plots.resize(document.getElementById('divePlot'));
      });

    </script>
  </body>
</html>
