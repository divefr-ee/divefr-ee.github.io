<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/apple-touch-icon-512x512.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>divefree: Kealakekua Bay</title>
    <script src="/plotly-basic.min.js"></script>
    <style>
        html {
          height: 100%;
          margin: 0;
          overflow: hidden;
        }
        body {
          height: 100%;
          font-family: Arial, sans-serif;
          color: #555;
          overflow-y: auto;
          overflow-x: hidden;
        }
        #divePlot {
          width: 100%;
        }
        #mapPane {
          width: 100%;
        }
    </style>
  </head>
  <body>
    
    <div id="divePlot"></div>
    
    <br/>

    <div id="mapPane">
      <center>
        <iframe
            id="mapIframe"
            width="70%"
            height="200px"
            loading="lazy"
            frameborder="0"
            scrolling="no"
            src="https://www.openstreetmap.org/export/embed.html?bbox=-0.1%2C-0.1%2C0.1%2C0.1&marker=0,0">
        </iframe>
      </center>
    </div>
    
    <script>
      const title = '';
      const xlabel = 'time (s)';
      const ylabel1 = 'depth (m)';
      const ylabel2 = 'rate (m/s)';
      const color1 = 'royalblue';
      const color2 = 'grey';
      const dataset = {
        date: "2024-11-19",
        time: "09:08:42",
        lat: 19.481084,
        lon: -155.932112,
        locname: "Kealakekua Bay",
        t: [0,0.25,0.5,0.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5,5.25,5.5,5.75,6,6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25,8.5,8.75,9,9.25,9.5,9.75,10,10.25,10.5,10.75,11,11.25,11.5,11.75,12,12.25,12.5,12.75,13,13.25,13.5,13.75,14,14.25,14.5,14.75,15,15.25,15.5,15.75,16,16.25,16.5,16.75,17,17.25,17.5,17.75,18,18.25,18.5,18.75,19,19.25,19.5,19.75,20,20.25,20.5,20.75,21,21.25,21.5,21.75,22,22.25,22.5,22.75,23,23.25,23.5,23.75,24,24.25,24.5,24.75,25,25.25,25.5,25.75,26,26.25,26.5,26.75,27,27.25,27.5,27.75,28,28.25,28.5,28.75,29,29.25,29.5,29.75,30,30.25,30.5,30.75,31,31.25,31.5,31.75,32,32.25,32.5,32.75,33,33.25,33.5,33.75,34,34.25,34.5,34.75,35,35.25,35.5,35.75,36],
        depth: [-0.46,-0.46,-0.75,-0.65,-0.98,-1.07,-1.12,-1.76,-2.15,-2.38,-2.58,-2.7,-2.89,-3.19,-3.4,-3.55,-3.73,-3.94,-4.09,-4.28,-4.46,-4.61,-4.79,-5.03,-5.22,-5.39,-5.57,-5.83,-6.07,-6.28,-6.48,-6.73,-6.95,-7.17,-7.4,-7.61,-7.8,-8.03,-8.24,-8.48,-8.69,-8.91,-9.1,-9.32,-9.56,-9.76,-10.03,-10.14,-9.97,-10.07,-10.51,-10.91,-11.02,-11,-10.93,-10.73,-10.76,-11.18,-11.3,-11.19,-10.67,-10.44,-10.77,-11.4,-11.18,-10.72,-10.89,-11.39,-11.31,-11.06,-11.11,-11.2,-10.93,-11.1,-11.35,-11.06,-11.04,-11.36,-11.38,-11.09,-11.08,-11.08,-10.94,-10.87,-10.82,-10.63,-10.63,-10.37,-10.14,-9.89,-9.7,-9.46,-9.17,-8.96,-8.74,-8.45,-8.25,-7.99,-7.69,-7.44,-7.16,-6.87,-6.54,-6.22,-5.92,-5.63,-5.31,-4.99,-4.67,-4.34,-4.06,-3.64,-3.35,-3.12,-2.77,-2.49,-2.26,-1.9,-1.63,-1.41,-1.08,-0.77,-0.4,-0.44,-0.31,-0.13,-0.55,-0.55,-0.41,-0.27,-0.57,-0.54,-0.36,-0.35,-0.54,-0.57,-0.47,-0.33,-0.4,-0.41,-0.25,-0.56,-0.49,-0.35,-0.3],
        temperature: ["26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.50","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.50","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.50","26.60","26.60","26.60","26.60","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50","26.50"],
        vertrates: [0,-0.348,-0.1236,-0.48252,-0.445764,-0.3720348,-1.02842436,-1.187897052,-1.1075279364,-1.01526955548,-0.854688688836,-0.8262820821852,-0.93839745752964,-0.908878220270748,-0.816214754189523,-0.787350327932666,-0.803145229552866,-0.742201660687006,-0.747541162480905,-0.739278813736633,-0.697495169615643,-0.70424661873095,-0.780972633111665,-0.774680843178165,-0.746276590224715,-0.738393613157301,-0.828875529210111,-0.868212870447078,-0.859749009312954,-0.841824306519068,-0.889277014563348,-0.886493910194343,-0.88454573713604,-0.895182015995228,-0.87862741119666,-0.843039187837661,-0.866127431486362,-0.858289202040455,-0.888802441428318,-0.874161708999822,-0.875913196299876,-0.841139237409912,-0.85279746618694,-0.884958226330858,-0.8594707584316,-0.925629530902119,-0.779940671631485,-0.341958470142039,-0.359370929099427,-0.779559650369598,-1.02569175525872,-0.849984228681103,-0.570988960076772,-0.31569227205374,0.0190154095623809,-0.0226892133063326,-0.519882449314433,-0.507917714520104,-0.223542400164071,0.467520319885149,0.603264223919605,0.0262849567437235,-0.737600530279394,-0.252320371195575,0.375375740163096,0.0587630181141673,-0.558865887320083,-0.295206121124058,0.0933557152131595,0.00534900064921293,-0.104255699545551,0.251021010318114,-0.0282852927773202,-0.319799704944124,0.124140206539112,0.11089814457738,-0.306371298795834,-0.238459909157086,0.181078063590041,0.138754644513029,0.09712825115912,0.235989775811385,0.24919284306797,0.234434990147577,0.392104493103304,0.274473145172312,0.504131201620621,0.628891841134433,0.740224288794103,0.746157002155874,0.81030990150911,0.915216931056378,0.892651851739463,0.888856296217625,0.970199407352339,0.919139585146636,0.955397709602645,1.02877839672185,1.0201448777053,1.05010141439371,1.0830709900756,1.15414969305292,1.19190478513704,1.19433334959593,1.18403334471715,1.21282334130201,1.2329763389114,1.24708343723798,1.26895840606659,1.22427088424661,1.36098961897263,1.30069273328084,1.18648491329659,1.25053943930761,1.21137760751533,1.12396432526073,1.21877502768251,1.17714251937776,1.08799976356443,1.1575998344951,1.18231988414657,1.2716239189026,0.84213674323182,0.745495720262274,0.737847004183592,0.012492902928514,0.00874503204995981,0.174121522434972,0.28988506570448,-0.157080454006864,-0.0739563178048047,0.164230577536637,0.126961404275646,-0.139127017007048,-0.133388911904934,0.0266277616665465,0.186639433166583,0.0466476032166078,0.0206533222516254,0.206457325576138,-0.227479872096704,-0.0752359104676924,0.115334862672615,0.140734403870831,0.158514082709581]
      };
      function updatePlot() {

        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);  // Get full minutes
          const sec = seconds % 60;  // Get the fractional part of the seconds

          // Check if the fractional part is zero
          if (sec % 1 === 0) {
            return `${minutes.toString().padStart(2, '0')}:${Math.floor(sec).toString().padStart(2, '0')}`; // No decimal part if it's zero
          } else {
            return `${minutes.toString().padStart(2, '0')}:${sec.toFixed(2).padStart(5, '0')}`; // With fractional seconds
          }
        }

        // Calculate the time difference (dt) between the first two timestamps
        var dt = dataset.t[1] - dataset.t[0];
        
        dataset.t = dataset.t.map(formatTime);

        // Calculate the number of samples needed to cover 5 seconds
        var tickInterval = Math.round(5 / dt);
        var tickVals = dataset.t.filter((time, index) => index % tickInterval === 0);
        var tickText = tickVals;

        var colors = dataset.vertrates.map(rate => {
          if (rate < 0) {
            return 'dark'+color2;
          } else return 'light'+color2;
        });

        Plotly.react('divePlot', [
          {
            x: dataset.t,
            y: dataset.depth,
            mode: 'lines',
            type: 'scatter',
            name: ylabel1,
            yaxis: 'y',
            line: { color: color1 },
            zorder: 2
          },
          {
            x: dataset.t,
            y: dataset.vertrates,
            mode: 'lines',
            type: 'bar',
            name: ylabel2,
            yaxis: 'y2',
            marker: { color: colors },
            zorder: 1
          }
        ], {
          title: dataset.date + " // " + dataset.time + " // " + dataset.locname,
          showlegend: false,
          xaxis: { 
            title: xlabel,
            tickvals: tickVals,
            ticktext: tickText
          },
          yaxis: { title: ylabel1, side: 'left', titlefont: { color: color1 }, tickfont: { color: color1 } },
          yaxis2: {
            title: ylabel2,
            overlaying: 'y',
            side: 'right',
            titlefont: { color: color2 },
            tickfont: { color: color2 },
            showgrid: false 
          }
        });

        // Update the iframe URL with new coordinates and bbox
        const lat = dataset.lat;
        const lon = dataset.lon;
        if (lat && lon ){
          const newBBox = `${lon - 0.03}%2C${lat - 0.03}%2C${lon + 0.03}%2C${lat + 0.03}`;
          const newMarker = `${lat},${lon}`;
          const newIframeSrc = `https://www.openstreetmap.org/export/embed.html?bbox=${newBBox}&marker=${newMarker}`;
          document.getElementById('mapIframe').src = newIframeSrc;
        }else{
          document.getElementById('mapIframe').src = ``;
        }
      }

      // Initial plot with the first dataset
      updatePlot();

      window.addEventListener('resize', function() {
        Plotly.Plots.resize(document.getElementById('divePlot'));
      });

    </script>
  </body>
</html>
