<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/apple-touch-icon-512x512.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>divefree: Kealakekua Bay</title>
    <script src="/plotly-basic.min.js"></script>
    <style>
        html {
          height: 100%;
          margin: 0;
          overflow: hidden;
        }
        body {
          height: 100%;
          font-family: Arial, sans-serif;
          color: #555;
          overflow-y: auto;
          overflow-x: hidden;
        }
        #divePlot {
          width: 100%;
        }
        #mapPane {
          width: 100%;
        }
    </style>
  </head>
  <body>
    
    <div id="divePlot"></div>
    
    <br/>

    <div id="mapPane">
      <center>
        <iframe
            id="mapIframe"
            width="70%"
            height="200px"
            loading="lazy"
            frameborder="0"
            scrolling="no"
            src="https://www.openstreetmap.org/export/embed.html?bbox=-0.1%2C-0.1%2C0.1%2C0.1&marker=0,0">
        </iframe>
      </center>
    </div>
    
    <script>
      const title = '';
      const xlabel = 'time (s)';
      const ylabel1 = 'depth (m)';
      const ylabel2 = 'rate (m/s)';
      const color1 = 'royalblue';
      const color2 = 'darkgrey';
      const dataset = {
        date: "2024-11-19",
        time: "09:41:51",
        lat: 19.481084,
        lon: -155.932112,
        locname: "Kealakekua Bay",
        t: [0.25,0.5,0.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5,5.25,5.5,5.75,6,6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25,8.5,8.75,9,9.25,9.5,9.75,10,10.25,10.5,10.75,11,11.25,11.5,11.75,12,12.25,12.5,12.75,13,13.25,13.5,13.75,14,14.25,14.5,14.75,15,15.25,15.5,15.75,16,16.25,16.5,16.75,17,17.25,17.5,17.75,18,18.25,18.5,18.75,19,19.25,19.5,19.75,20,20.25,20.5,20.75,21,21.25,21.5,21.75,22,22.25,22.5,22.75,23,23.25,23.5,23.75,24,24.25,24.5,24.75,25,25.25,25.5,25.75,26,26.25,26.5,26.75,27,27.25,27.5,27.75,28,28.25,28.5,28.75,29,29.25,29.5,29.75,30,30.25,30.5,30.75,31,31.25,31.5,31.75,32,32.25,32.5,32.75,33,33.25,33.5,33.75,34,34.25,34.5,34.75,35,35.25],
        depth: [-0.27,-0.49,-0.78,-1.4,-0.55,-1.01,-1.1,-1.66,-2.1,-2.28,-2.38,-2.45,-2.55,-2.72,-2.82,-2.9,-2.97,-3.01,-3.05,-3.11,-3.13,-3.17,-3.2,-3.24,-3.27,-3.32,-3.34,-3.34,-3.17,-2.67,-2.94,-3.06,-3.04,-3.05,-3.1,-3.16,-3.29,-3.39,-3.22,-3.22,-3.26,-3.23,-3.23,-3.11,-3.1,-3.12,-3.15,-3.14,-3.12,-3.1,-3.04,-3.02,-2.95,-2.9,-2.59,-2.62,-2.66,-2.48,-2.58,-2.66,-2.49,-2.53,-2.64,-2.64,-2.6,-2.67,-2.72,-2.53,-2.8,-2.43,-2.48,-2.65,-2.52,-2.54,-2.51,-2.44,-2.47,-2.46,-2.41,-2.44,-2.46,-2.36,-2.36,-2.37,-2.32,-2.3,-2.19,-2.13,-2.13,-2.03,-2.01,-2.12,-2.06,-1.99,-2.03,-1.9,-1.89,-1.95,-1.74,-1.77,-1.81,-2.02,-2.11,-1.7,-1.76,-1.68,-1.57,-1.4,-1.32,-1.57,-1.05,-1.18,-1.21,-1.04,-0.84,-0.89,-0.92,-0.9,-0.63,-0.7,-0.17,-0.19,-0.18,-0.11,-0.12,-0.08,0.06,-0.29,-0.13,-0.16,-0.15,-0.1,-0.05,-0.27,-0.22,-0.03,-0.18,-0.5,-0.31,-0.1,-0.08],
        temperature: ["26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.20","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.30","26.40","26.40","26.30","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.30","26.30","26.30","26.30","26.30","26.30","26.30"],
        vertrates: [-0.88,-0.964,-1.4188,0.02684,-0.533212,-0.4812484,-1.00887388,-1.234211716,-1.0799482012,-0.87596374084,-0.697174618588,-0.6080222330116,-0.62961556310812,-0.560730894175684,-0.488511625922978,-0.425958138146085,-0.346170696702259,-0.290319487691582,-0.275223641384107,-0.216656548968875,-0.199659584278213,-0.175761708994749,-0.171033196296324,-0.155723237407427,-0.169006266185199,-0.142304386329639,-0.0996130704307473,0.134270850698477,0.693989595488934,0.161792716842254,-0.0307450982104227,0.00247843125270417,-0.0102650981231068,-0.0671855686861751,-0.119029898080323,-0.239320928656226,-0.287524650059358,0.00273274495844922,0.00191292147091445,-0.0466609549703594,0.00333733152074819,0.00233613206452373,0.145635292445167,0.113944704711616,0.0557612932981315,0.00303290530869228,0.0141230337160843,0.0338861236012591,0.0477202865208814,0.105404200564617,0.0977829403952319,0.152448058276662,0.166713640793664,0.488699548555565,0.306089683988895,0.166262778792226,0.332383945154559,0.112668761608191,-0.0171318668742664,0.192007693188013,0.0864053852316093,-0.0715162303378733,-0.0500613612365113,0.0129570471344421,-0.0749300670058903,-0.112451046904123,0.149284267167113,-0.21950101298302,0.290349290911885,0.14324450363832,-0.103728847453176,0.0833898067827767,0.0343728647479437,0.0600610053235609,0.126042703726492,0.0522298926085444,0.0485609248259814,0.0939926473781867,0.0297948531647309,-0.00314360278468837,0.117799478050718,0.0824596346355028,0.0457217442448517,0.0920052209713965,0.0884036546799775,0.193882558275984,0.207717790793189,0.145402453555232,0.221781717488663,0.179247202242064,-0.00652695843055567,0.0674311290986111,0.131201790369028,0.0438412532583197,0.186688877280824,0.142682214096576,0.0278775498676033,0.271514284907323,0.154059999435126,0.059841999604588,-0.210110600276788,-0.255077420193752,0.313445805864373,0.147412064105062,0.199188444873543,0.27143191141148,0.394002337988036,0.371801636591625,-0.0397388543858624,0.596182801929896,0.261327961350928,0.146929572945649,0.306850701061954,0.454795490743368,0.258356843520358,0.14484979046425,0.125394853324975,0.411776397327483,0.204243478129238,0.778970434690466,0.521279304283326,0.376895512998329,0.34782685909883,0.231478801369181,0.210035160958427,0.315024612670899,-0.199482771130371,0.0523620602087403,0.000653442146118226,0.0124574095022828,0.0687201866515979,0.108104130656119,-0.188327108540717,-0.0718289759785019,0.177719716815049,-0.055596198229466,-0.422917338760626,-0.0680421371324383,0.204370504007293,0.167059352805105,0.140941546963574]
      };
      function updatePlot() {
        var colors = dataset.vertrates.map(rate => {
          if (rate < 0) {
            return 'darkgrey';
          } else return 'lightgrey';
        });

        Plotly.react('divePlot', [
          {
            x: dataset.t,
            y: dataset.depth,
            mode: 'lines',
            type: 'scatter',
            name: ylabel1,
            yaxis: 'y',
            line: { color: color1 },
            zorder: 2
          },
          {
            x: dataset.t,
            y: dataset.vertrates,
            mode: 'lines',
            type: 'bar',
            name: ylabel2,
            yaxis: 'y2',
            marker: { color: colors },
            line: { color: color2 },
            zorder: 1
          }
        ], {
          title: dataset.date + " // " + dataset.time + " // " + dataset.locname,
          showlegend: false,
          xaxis: { title: xlabel },
          yaxis: { title: ylabel1, side: 'left', titlefont: { color: color1 }, tickfont: { color: color1 } },
          yaxis2: {
            title: ylabel2,
            overlaying: 'y',
            side: 'right',
            titlefont: { color: color2 },
            tickfont: { color: color2 },
            showgrid: false // Optional: Hide the grid for the right Y-axis
          }
        });

        // Update the iframe URL with new coordinates and bbox
        const lat = dataset.lat;
        const lon = dataset.lon;
        if (lat && lon ){
          const newBBox = `${lon - 0.03}%2C${lat - 0.03}%2C${lon + 0.03}%2C${lat + 0.03}`;
          const newMarker = `${lat},${lon}`;
          const newIframeSrc = `https://www.openstreetmap.org/export/embed.html?bbox=${newBBox}&marker=${newMarker}`;
          document.getElementById('mapIframe').src = newIframeSrc;
        }else{
          document.getElementById('mapIframe').src = ``;
        }
      }

      // Initial plot with the first dataset
      updatePlot();

      // Resize plot on window resize
      window.addEventListener('resize', function() {
        checkOrientation();
        Plotly.Plots.resize(document.getElementById('divePlot'));
      });
    </script>
  </body>
</html>
