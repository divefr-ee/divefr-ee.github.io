<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/apple-touch-icon-512x512.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>divefree: Maluaka Beach</title>
    <script src="/plotly-basic.min.js"></script>
    <style>
        html {
          height: 100%;
          margin: 0;
          overflow: hidden;
        }
        body {
          height: 100%;
          font-family: Arial, sans-serif;
          color: #555;
          overflow-y: auto;
          overflow-x: hidden;
        }
        #divePlot {
          width: 100%;
        }
        #mapPane {
          width: 100%;
        }
    </style>
  </head>
  <body>
    
    <div id="divePlot"></div>
    
    <br/>

    <div id="mapPane">
      <center>
        <iframe
            id="mapIframe"
            width="70%"
            height="200px"
            loading="lazy"
            frameborder="0"
            scrolling="no"
            src="https://www.openstreetmap.org/export/embed.html?bbox=-0.1%2C-0.1%2C0.1%2C0.1&marker=0,0">
        </iframe>
      </center>
    </div>
    
    <script>
      const title = '';
      const xlabel = 'time (s)';
      const ylabel1 = 'depth (m)';
      const ylabel2 = 'rate (m/s)';
      const color1 = 'royalblue';
      const color2 = 'darkgrey';
      const dataset = {
        date: "2024-11-24",
        time: "10:32:49",
        lat: 20.6461,
        lon: -156.44405,
        locname: "Maluaka Beach",
        t: [0.25,0.5,0.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5,5.25,5.5,5.75,6,6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25,8.5,8.75,9,9.25,9.5,9.75,10,10.25,10.5,10.75,11,11.25,11.5,11.75,12,12.25,12.5,12.75,13,13.25,13.5,13.75,14,14.25,14.5,14.75,15,15.25,15.5,15.75,16,16.25,16.5,16.75,17,17.25,17.5,17.75,18,18.25,18.5,18.75,19,19.25,19.5,19.75,20,20.25,20.5,20.75,21,21.25,21.5,21.75,22,22.25,22.5,22.75,23,23.25,23.5,23.75,24,24.25,24.5,24.75,25,25.25,25.5,25.75,26,26.25,26.5,26.75,27,27.25,27.5,27.75,28,28.25,28.5,28.75,29,29.25,29.5,29.75,30,30.25],
        depth: [-0.66,-0.51,-0.5,-0.56,-0.36,-0.36,-0.1,-0.77,-1.2,-1.42,-1.56,-1.49,-1.31,-1.42,-2.1,-1.99,-2.01,-1.81,-2.09,-2.56,-2.51,-2.22,-1.99,-2.04,-2.74,-2.94,-2.81,-2.68,-2.39,-2.38,-2.73,-3.06,-2.94,-2.69,-2.67,-2.77,-3.03,-3.05,-3.06,-3.06,-3.08,-3.04,-3.12,-3.11,-3.14,-3.11,-3.07,-3.07,-3.06,-3.05,-3.04,-3.05,-3.05,-3.07,-3.07,-3.05,-3.05,-3.05,-3.05,-3.06,-3.05,-3.09,-3.1,-3.1,-3.11,-3.1,-3.11,-3.12,-3.12,-3.13,-3.15,-3.14,-3.17,-3.18,-3.23,-3.26,-3.29,-3.32,-3.34,-3.21,-2.99,-2.44,-2.67,-2.68,-2.53,-2.43,-2.24,-2.3,-2.24,-2.18,-2.09,-2,-1.9,-1.68,-1.51,-1.47,-1.35,-1.11,-1,-0.91,-0.44,-0.35,-0.41,-0.43,-0.27,-0.55,-0.65,-0.4,-0.29,-0.57,-0.46,-0.42,-0.61,-0.37,-0.59,-0.61,-0.42,-0.54,-0.6,-0.41,-0.37],
        temperature: ["26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40","26.40"],
        vertrates: [0.6,0.432,0.2304,0.40128,0.280896,0.5086272,-0.44796096,-0.829572672,-0.8447008704,-0.75929060928,-0.447503426496,-0.0972523985472,-0.20007667898304,-0.956053675288128,-0.537237572701689,-0.400066300891182,-0.040046410623828,-0.364032487436679,-0.818822741205676,-0.513175918843973,-0.0112231431907813,0.268143799766453,0.127700659836517,-0.750609538114438,-0.765426676680106,-0.379798673676075,-0.109859071573252,0.271098649898723,0.201769054929107,-0.278761661549625,-0.591133163084738,-0.269793214159316,0.111144750088479,0.101801325061935,-0.0487390724566456,-0.346117350719652,-0.266282145503756,-0.19839750185263,-0.138878251296841,-0.121214775907789,-0.0368503431354519,-0.121795240194816,-0.0732566681363712,-0.0872796676954601,-0.0250957673868218,0.0304329628292248,0.0213030739804573,0.0269121517863199,0.0308385062504242,0.0335869543752967,0.0115108680627079,0.00805760764389555,-0.0183596746492731,-0.0128517722544912,0.0150037594218562,0.0105026315952993,0.00735184211670953,0.00514628948169667,-0.00839759736281261,0.00612168184603145,-0.043714822707778,-0.0426003758954449,-0.0298202631268114,-0.0328741841887677,-0.0110119289321377,-0.0197083502524961,-0.0257958451767476,-0.0180570916237233,-0.024639964136606,-0.0412479748956242,-0.0168735824269372,-0.0478115076988558,-0.0454680553891993,-0.0918276387724393,-0.100279347140707,-0.106195542998495,-0.110336880098947,-0.101235816069263,0.085134928751516,0.323594450126061,0.886516115088243,0.34456128056177,0.229192896393239,0.340435027475267,0.358304519232687,0.478813163462881,0.263169214424017,0.256218450096811,0.251352915067768,0.283947040547438,0.306762928383206,0.334734049868245,0.498313834907771,0.55281968443544,0.434973779104808,0.448481645373365,0.601937151761356,0.553356006232949,0.495349204363064,0.910744443054145,0.745521110137901,0.449864777096531,0.290905343967572,0.3956337407773,-0.0590563814558899,-0.161339467019123,0.187062373086614,0.26294366116063,-0.151939437187559,0.0256423939687086,0.065949675778096,-0.181835226955333,0.160715341131267,-0.151499261208113,-0.130049482845679,0.136965362008025,-0.0481242465943828,-0.105686972616068,0.154019119168752,0.155813383418127,0.157069368392689]
      };
      function updatePlot() {
        var colors = dataset.vertrates.map(rate => {
          if (rate < 0) {
            return 'darkgrey';
          } else return 'lightgrey';
        });

        Plotly.react('divePlot', [
          {
            x: dataset.t,
            y: dataset.depth,
            mode: 'lines',
            type: 'scatter',
            name: ylabel1,
            yaxis: 'y',
            line: { color: color1 },
            zorder: 2
          },
          {
            x: dataset.t,
            y: dataset.vertrates,
            mode: 'lines',
            type: 'bar',
            name: ylabel2,
            yaxis: 'y2',
            marker: { color: colors },
            line: { color: color2 },
            zorder: 1
          }
        ], {
          title: dataset.date + " // " + dataset.time + " // " + dataset.locname,
          showlegend: false,
          xaxis: { title: xlabel },
          yaxis: { title: ylabel1, side: 'left', titlefont: { color: color1 }, tickfont: { color: color1 } },
          yaxis2: {
            title: ylabel2,
            overlaying: 'y',
            side: 'right',
            titlefont: { color: color2 },
            tickfont: { color: color2 },
            showgrid: false // Optional: Hide the grid for the right Y-axis
          }
        });

        // Update the iframe URL with new coordinates and bbox
        const lat = dataset.lat;
        const lon = dataset.lon;
        if (lat && lon ){
          const newBBox = `${lon - 0.03}%2C${lat - 0.03}%2C${lon + 0.03}%2C${lat + 0.03}`;
          const newMarker = `${lat},${lon}`;
          const newIframeSrc = `https://www.openstreetmap.org/export/embed.html?bbox=${newBBox}&marker=${newMarker}`;
          document.getElementById('mapIframe').src = newIframeSrc;
        }else{
          document.getElementById('mapIframe').src = ``;
        }
      }

      // Initial plot with the first dataset
      updatePlot();

      // Resize plot on window resize
      window.addEventListener('resize', function() {
        Plotly.Plots.resize(document.getElementById('divePlot'));
      });
    </script>
  </body>
</html>
