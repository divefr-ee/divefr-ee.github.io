<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/apple-touch-icon-512x512.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>divefree: Maluaka Beach</title>
    <script src="/plotly-basic.min.js"></script>
    <style>
        html {
          height: 100%;
          margin: 0;
          overflow: hidden;
        }
        body {
          height: 100%;
          font-family: Arial, sans-serif;
          color: #555;
          overflow-y: auto;
          overflow-x: hidden;
        }
        #divePlot {
          width: 100%;
        }
        #mapPane {
          width: 100%;
        }
    </style>
  </head>
  <body>
    
    <div id="divePlot"></div>
    
    <br/>

    <div id="mapPane">
      <center>
        <iframe
            id="mapIframe"
            width="70%"
            height="200px"
            loading="lazy"
            frameborder="0"
            scrolling="no"
            src="https://www.openstreetmap.org/export/embed.html?bbox=-0.1%2C-0.1%2C0.1%2C0.1&marker=0,0">
        </iframe>
      </center>
    </div>
    
    <script>
      const title = '';
      const xlabel = 'time (s)';
      const ylabel1 = 'depth (m)';
      const ylabel2 = 'rate (m/s)';
      const color1 = 'royalblue';
      const color2 = 'darkgrey';
      const dataset = {
        date: "2024-11-24",
        time: "10:24:43",
        lat: 20.6461,
        lon: -156.44405,
        locname: "Maluaka Beach",
        t: [0.25,0.5,0.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5,5.25,5.5,5.75,6,6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25,8.5,8.75,9,9.25,9.5,9.75,10,10.25,10.5,10.75,11,11.25,11.5,11.75,12,12.25,12.5,12.75,13,13.25,13.5,13.75,14,14.25,14.5,14.75,15,15.25],
        depth: [-0.96,-0.91,-0.96,-0.92,-0.7,-0.63,-0.79,-1.27,-1.73,-1.78,-1.55,-1.15,-1.4,-1.82,-1.88,-2.12,-2.49,-2.46,-2.37,-2.32,-2.43,-2.51,-2.51,-2.75,-2.92,-2.87,-2.77,-2.6,-2.61,-2.17,-2.27,-2.38,-1.77,-1.92,-2.05,-1.51,-1.45,-1.23,-0.96,-0.78,-0.61,-0.44,-0.27,-0.06,-0.03,-0.01,-0,0.02,0.02,-0.13,-0.35,-0.25,-0.24,-0.01,-0.31,-0.28,-0.2,-0.08,-0.36,-0.44,-0.2],
        temperature: ["26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60","26.60"],
        vertrates: [0.2,0.0799999999999999,0.104,0.3368,0.31976,0.0318319999999999,-0.5537176,-0.93960232,-0.717721624,-0.2264051368,0.32151640424,-0.0749385170319999,-0.5564569619224,-0.46151987334568,-0.611063911341976,-0.871744737939383,-0.574221316557568,-0.293954921590298,-0.145768445113208,-0.234037911579246,-0.259826538105472,-0.18187857667383,-0.415315003671681,-0.494720502570177,-0.286304351799124,-0.0804130462593867,0.147710867618429,0.0913976073329007,0.59197832513303,0.294384827593121,0.0740693793151849,0.783848565520629,0.368693995864441,0.102085797105109,0.719460057973576,0.575622040581503,0.666935428407052,0.790854799884936,0.769598359919455,0.742718851943619,0.723903196360533,0.710732237452373,0.749512566216661,0.560658796351663,0.416461157446164,0.303522810212315,0.23646596714862,0.165526177004034,-0.0641316760971761,-0.308892173268023,-0.0962245212876162,-0.0553571649013313,0.237249984569068,-0.193925010801652,-0.0997475075611567,0.0261767447071903,0.162323721295033,-0.222373395093477,-0.251661376565434,0.111837036404196,0.366285925482937]
      };
      function updatePlot() {
        var colors = dataset.vertrates.map(rate => {
          if (rate < 0) {
            return 'darkgrey';
          } else return 'lightgrey';
        });

        Plotly.react('divePlot', [
          {
            x: dataset.t,
            y: dataset.depth,
            mode: 'lines',
            type: 'scatter',
            name: ylabel1,
            yaxis: 'y',
            line: { color: color1 },
            zorder: 2
          },
          {
            x: dataset.t,
            y: dataset.vertrates,
            mode: 'lines',
            type: 'bar',
            name: ylabel2,
            yaxis: 'y2',
            marker: { color: colors },
            line: { color: color2 },
            zorder: 1
          }
        ], {
          title: dataset.date + " // " + dataset.time + " // " + dataset.locname,
          showlegend: false,
          xaxis: { title: xlabel },
          yaxis: { title: ylabel1, side: 'left', titlefont: { color: color1 }, tickfont: { color: color1 } },
          yaxis2: {
            title: ylabel2,
            overlaying: 'y',
            side: 'right',
            titlefont: { color: color2 },
            tickfont: { color: color2 },
            showgrid: false // Optional: Hide the grid for the right Y-axis
          }
        });

        // Update the iframe URL with new coordinates and bbox
        const lat = dataset.lat;
        const lon = dataset.lon;
        if (lat && lon ){
          const newBBox = `${lon - 0.03}%2C${lat - 0.03}%2C${lon + 0.03}%2C${lat + 0.03}`;
          const newMarker = `${lat},${lon}`;
          const newIframeSrc = `https://www.openstreetmap.org/export/embed.html?bbox=${newBBox}&marker=${newMarker}`;
          document.getElementById('mapIframe').src = newIframeSrc;
        }else{
          document.getElementById('mapIframe').src = ``;
        }
      }

      // Initial plot with the first dataset
      updatePlot();

      // Resize plot on window resize
      window.addEventListener('resize', function() {
        checkOrientation();
        Plotly.Plots.resize(document.getElementById('divePlot'));
      });
    </script>
  </body>
</html>
